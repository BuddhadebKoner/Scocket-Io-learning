<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>MCQ Quiz Test Client</title>
   <style>
      body {
         font-family: Arial, sans-serif;
         max-width: 800px;
         margin: 0 auto;
         padding: 20px;
         background-color: #f5f5f5;
      }

      .container {
         background: white;
         padding: 20px;
         border-radius: 10px;
         box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .question {
         background: #e8f4f8;
         padding: 15px;
         margin: 10px 0;
         border-radius: 5px;
      }

      .options {
         margin: 15px 0;
      }

      .option {
         display: block;
         margin: 8px 0;
         padding: 10px;
         background: #f0f0f0;
         border: 1px solid #ddd;
         border-radius: 5px;
         cursor: pointer;
         transition: background-color 0.2s;
      }

      .option:hover {
         background: #e0e0e0;
      }

      .feedback {
         margin: 15px 0;
         padding: 10px;
         border-radius: 5px;
      }

      .feedback.correct {
         background: #d4edda;
         border: 1px solid #c3e6cb;
         color: #155724;
      }

      .feedback.incorrect {
         background: #f8d7da;
         border: 1px solid #f5c6cb;
         color: #721c24;
      }

      .results {
         background: #d1ecf1;
         border: 1px solid #bee5eb;
         color: #0c5460;
         padding: 20px;
         border-radius: 5px;
         margin: 20px 0;
      }

      .log {
         background: #f8f9fa;
         border: 1px solid #dee2e6;
         padding: 10px;
         max-height: 200px;
         overflow-y: auto;
         font-family: monospace;
         font-size: 12px;
      }

      button {
         background: #007bff;
         color: white;
         border: none;
         padding: 10px 20px;
         border-radius: 5px;
         cursor: pointer;
         margin: 5px;
      }

      button:hover {
         background: #0056b3;
      }

      button:disabled {
         background: #6c757d;
         cursor: not-allowed;
      }

      .status {
         padding: 10px;
         margin: 10px 0;
         border-radius: 5px;
         text-align: center;
      }

      .status.connected {
         background: #d4edda;
         color: #155724;
      }

      .status.disconnected {
         background: #f8d7da;
         color: #721c24;
      }
   </style>
</head>

<body>
   <div class="container">
      <h1>üéØ MCQ Quiz Test Client</h1>

      <div id="status" class="status disconnected">
         Disconnected
      </div>

      <button id="connectBtn" onclick="connect()">Connect to Quiz</button>
      <button id="disconnectBtn" onclick="disconnect()" disabled>Disconnect</button>

      <div id="welcomeMessage" style="display: none;"></div>
      <div id="questionContainer" style="display: none;"></div>
      <div id="feedbackContainer" style="display: none;"></div>
      <div id="resultsContainer" style="display: none;"></div>

      <h3>Connection Log</h3>
      <div id="log" class="log"></div>
   </div>

   <script>
      let ws = null;
      let currentQuestion = null;

      function log(message) {
         const logDiv = document.getElementById('log');
         const timestamp = new Date().toLocaleTimeString();
         logDiv.innerHTML += `[${timestamp}] ${message}\n`;
         logDiv.scrollTop = logDiv.scrollHeight;
      }

      function updateStatus(connected) {
         const statusDiv = document.getElementById('status');
         const connectBtn = document.getElementById('connectBtn');
         const disconnectBtn = document.getElementById('disconnectBtn');

         if (connected) {
            statusDiv.className = 'status connected';
            statusDiv.textContent = 'Connected to Quiz Server';
            connectBtn.disabled = true;
            disconnectBtn.disabled = false;
         } else {
            statusDiv.className = 'status disconnected';
            statusDiv.textContent = 'Disconnected';
            connectBtn.disabled = false;
            disconnectBtn.disabled = true;
         }
      }

      function connect() {
         try {
            ws = new WebSocket('ws://localhost:3000');

            ws.onopen = function () {
               log('‚úÖ Connected to WebSocket server');
               updateStatus(true);
            };

            ws.onmessage = function (event) {
               const data = JSON.parse(event.data);
               log(`üì® Received: ${JSON.stringify(data)}`);
               handleMessage(data);
            };

            ws.onclose = function () {
               log('üîå Disconnected from server');
               updateStatus(false);
               ws = null;
            };

            ws.onerror = function (error) {
               log(`‚ùå WebSocket error: ${error}`);
            };

         } catch (error) {
            log(`‚ùå Connection failed: ${error.message}`);
         }
      }

      function disconnect() {
         if (ws) {
            ws.close();
         }
      }

      function handleMessage(data) {
         switch (data.type) {
            case 'welcome':
               showWelcome(data);
               break;
            case 'question':
               showQuestion(data);
               break;
            case 'feedback':
               showFeedback(data);
               break;
            case 'results':
               showResults(data);
               break;
            case 'pong':
               log('üèì Pong received');
               break;
         }
      }

      function showWelcome(data) {
         const container = document.getElementById('welcomeMessage');
         container.style.display = 'block';
         container.innerHTML = `
                <div class="question">
                    <h2>Welcome to MCQ Quiz!</h2>
                    <p><strong>Student ID:</strong> ${data.studentId}</p>
                    <p><strong>Total Questions:</strong> ${data.totalQuestions}</p>
                    <h3>Instructions:</h3>
                    <ul>
                        ${data.instructions.map(instruction => `<li>${instruction}</li>`).join('')}
                    </ul>
                </div>
            `;
      }

      function showQuestion(data) {
         currentQuestion = data;
         const container = document.getElementById('questionContainer');
         container.style.display = 'block';

         document.getElementById('feedbackContainer').style.display = 'none';

         container.innerHTML = `
                <div class="question">
                    <h2>Question ${data.questionNumber} of ${data.totalQuestions}</h2>
                    <p><strong>${data.question}</strong></p>
                    <div class="options">
                        ${data.options.map((option, index) =>
            `<div class="option" onclick="selectAnswer(${index})">${index}: ${option}</div>`
         ).join('')}
                    </div>
                    <p><em>Time limit: ${data.timeLimit} seconds</em></p>
                </div>
            `;
      }

      function selectAnswer(answerIndex) {
         if (ws && currentQuestion) {
            const message = {
               type: 'answer',
               answerIndex: answerIndex
            };

            ws.send(JSON.stringify(message));
            log(`üì§ Sent answer: ${answerIndex} (${currentQuestion.options[answerIndex]})`);

            // Disable options after selecting
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
               option.style.pointerEvents = 'none';
               option.style.opacity = '0.6';
            });
         }
      }

      function showFeedback(data) {
         const container = document.getElementById('feedbackContainer');
         container.style.display = 'block';

         container.innerHTML = `
                <div class="feedback ${data.isCorrect ? 'correct' : 'incorrect'}">
                    <h3>${data.isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect!'}</h3>
                    <p>${data.explanation}</p>
                </div>
            `;
      }

      function showResults(data) {
         const container = document.getElementById('resultsContainer');
         container.style.display = 'block';

         document.getElementById('questionContainer').style.display = 'none';
         document.getElementById('feedbackContainer').style.display = 'none';

         container.innerHTML = `
                <div class="results">
                    <h2>üéØ Quiz Complete!</h2>
                    <h3>${data.message}</h3>
                    <p><strong>Score:</strong> ${data.score} out of ${data.totalQuestions} (${data.percentage}%)</p>
                    <p><strong>Total Time:</strong> ${data.totalTime} seconds</p>
                    
                    <h3>Detailed Results:</h3>
                    <div style="text-align: left;">
                        ${data.answers.map((answer, index) => `
                            <p><strong>Question ${index + 1}:</strong> 
                            ${answer.isCorrect ? '‚úÖ' : '‚ùå'} 
                            Your answer: ${answer.selectedAnswer}, 
                            Correct: ${answer.correctAnswer}</p>
                        `).join('')}
                    </div>
                    
                    <p><em>Connection will close automatically in 5 seconds...</em></p>
                </div>
            `;
      }

      function sendPing() {
         if (ws) {
            const message = { type: 'ping' };
            ws.send(JSON.stringify(message));
            log('üèì Ping sent');
         }
      }

      // Auto-connect on page load for testing
      window.onload = function () {
         log('üöÄ MCQ Quiz Test Client loaded');
         log('Click "Connect to Quiz" to start the quiz');
      };
   </script>
</body>

</html>